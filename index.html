<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>US Earnings (Yahoo Finance)</title>
<style>
  body {
    background-color: #0f1116;
    color: #e0e0e0;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 20px;
  }
  h2 {
    color: #00ccff;
    text-align: center;
  }
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-bottom: 20px;
  }
  input, button {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    outline: none;
    font-size: 14px;
  }
  input[type="date"] {
    background-color: #1c1f26;
    color: #fff;
  }
  button {
    background-color: #00ccff;
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    background-color: #00a3cc;
  }
  table {
    width: 90%;
    margin: 0 auto;
    border-collapse: collapse;
    background-color: #1a1d24;
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    padding: 12px;
    border-bottom: 1px solid #333;
    text-align: left;
  }
  th {
    background-color: #232731;
    color: #00ccff;
  }
  tr:hover {
    background-color: #2a2f3d;
  }
  #status {
    text-align: center;
    margin-top: 15px;
    color: #aaa;
  }
</style>
</head>
<body>

<h2>üìä US Earnings (Yahoo Finance)</h2>

<div class="filters">
  <div>
    <label>Od: <input type="date" id="fromDate" value="2025-11-03"></label>
  </div>
  <div>
    <label>Do: <input type="date" id="toDate" value="2025-11-14"></label>
  </div>
  <button id="loadBtn">Naƒç√≠st data</button>
</div>

<table id="earningsTable">
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Spoleƒçnost</th>
      <th>Datum</th>
      <th>Seance</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="status">Zadej rozsah a klikni na ‚ÄûNaƒç√≠st data‚Äú</div>

<script>
async function fetchEarningsForDay(dateStr) {
  const url = `https://api.allorigins.win/raw?url=https://query2.finance.yahoo.com/v1/finance/calendar/earnings?day=${dateStr}`;
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠");
    const data = await res.json();
    const list = data.finance?.result || [];
    return list.map(e => ({
      ticker: e.symbol,
      name: e.companyshortname,
      date: e.startdatetime ? e.startdatetime.split("T")[0] : dateStr,
      session: e.time?.includes("After") ? "AMC" : e.time?.includes("Before") ? "BMO" : "-"
    }));
  } catch (err) {
    console.warn("Chyba pro den:", dateStr, err);
    return [];
  }
}

function getDateRange(start, end) {
  const arr = [];
  let d = new Date(start);
  while (d <= new Date(end)) {
    arr.push(d.toISOString().split("T")[0]);
    d.setDate(d.getDate() + 1);
  }
  return arr;
}

document.getElementById("loadBtn").addEventListener("click", async () => {
  const from = document.getElementById("fromDate").value;
  const to = document.getElementById("toDate").value;
  const tbody = document.querySelector("#earningsTable tbody");
  tbody.innerHTML = "";
  document.getElementById("status").innerText = "‚è≥ Naƒç√≠t√°m data...";
  
  const days = getDateRange(from, to);
  let all = [];

  for (const day of days) {
    const results = await fetchEarningsForDay(day);
    all = all.concat(results);
  }

  if (all.length === 0) {
    document.getElementById("status").innerText = "‚ùå ≈Ω√°dn√° data nenalezena v dan√©m rozsahu.";
    return;
  }

  all.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.ticker || "-"}</td>
      <td>${item.name || "-"}</td>
      <td>${item.date}</td>
      <td>${item.session}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("status").innerText = `‚úÖ Naƒçteno ${all.length} titul≈Ø`;
});
</script>

</body>
</html>
