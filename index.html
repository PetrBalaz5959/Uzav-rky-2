<!doctype html>
<html lang="cs" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US Earnings | 3‚Äì14. 11. 2025</title>
  <meta name="description" content="Prozat√≠mn√≠ p≈ôehled v≈°ech earnings term√≠n≈Ø na US burz√°ch pro t√Ωden 3.‚Äì14. 11. 2025 s filtry a mo≈ænost√≠ eToro filtru." />
  <style>
    :root{ --bg:#0b0d10; --panel:#11161d; --text:#e7eef6; --muted:#87a0b7; --line:rgba(130,150,170,.2); --accent:#17c193; --accent2:#5ea0ff; --ring:rgba(23,193,147,.25); }
    [data-theme="light"]{ --bg:#f6f8fb; --panel:#ffffff; --text:#0e1722; --muted:#5e7187; --line:rgba(100,115,140,.25); --accent:#0db37b; --accent2:#216cff; --ring:rgba(13,179,123,.18) }
    *{ box-sizing:border-box }
    body{ margin:0; background:var(--bg); color:var(--text); font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,"Helvetica Neue",Arial; }
    .container{ max-width:1200px; margin:34px auto; padding:0 18px }
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px }
    .title{ display:flex; align-items:center; gap:12px }
    .badge{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.12) }
    .controls{ display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:10px; margin-bottom:12px }
    .control{ display:flex; flex-direction:column; gap:6px }
    label{ font-size:12px; color:var(--muted) }
    input,select{ appearance:none; background:transparent; color:var(--text); border:1px solid var(--line); border-radius:12px; padding:10px 12px; outline:none; transition:.15s ease }
    input:focus,select:focus{ border-color:var(--accent); box-shadow:0 0 0 4px var(--ring) }
    .toolbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 }
    .btn{ border:1px solid var(--line); background:transparent; color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:700 }
    .btn.primary{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; border:none }
    .switch{ display:flex; gap:8px; align-items:center }
    .chip{ background:rgba(130,150,170,.16); border:1px solid var(--line); padding:6px 10px; border-radius:999px; font-size:12px; color:var(--text) }
    .table-wrap{ overflow:auto; border-radius:14px; border:1px solid var(--line) }
    table{ width:100%; border-collapse:separate; border-spacing:0; min-width:880px }
    thead th{ position:sticky; top:0; background:var(--panel); color:var(--muted); padding:12px; text-align:left; border-bottom:1px solid var(--line) }
    tbody td{ padding:12px; border-bottom:1px dashed var(--line) }
    tbody tr:hover{ background:rgba(130,150,170,.08) }
    .mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace }
    .pill{ padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; display:inline-block }
    .pill.amc{ background:rgba(94,160,255,.15); color:var(--accent2) }
    .pill.bmo{ background:rgba(23,193,147,.15); color:var(--accent) }
    .muted{ color:var(--muted) }
    .footer{ margin:18px 0; color:var(--muted); font-size:12px; text-align:center }
    .split{ display:grid; grid-template-columns:1fr auto; gap:10px }
    @media (max-width: 980px){ .controls{ grid-template-columns: repeat(2, minmax(0,1fr)); } .split{ grid-template-columns:1fr } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <span class="badge">US Earnings</span>
        <div>
          <h1 style="margin:0;font-size:22px">3‚Äì14. listopadu 2025 <span class="muted">(prozat√≠mn√≠ p≈ôehled)</span></h1>
          <div class="muted" style="font-size:13px">Naƒçti CSV/JSON s kalend√°≈ôem earnings, filtruj na <b>eToro</b> tickery a podle seance (BMO/AMC).</div>
        </div>
      </div>
      <div class="switch">
        <span class="chip" id="updated">Aktualizov√°no: ‚Äî</span>
        <button class="btn" id="themeBtn" title="P≈ôepnout svƒõtl√©/tmav√©">üåì</button>
      </div>
    </header>

    <section class="card">
      <div class="controls">
        <div class="control">
          <label>Rozsah data</label>
          <div class="split">
            <input type="date" id="from" value="2025-11-03" />
            <input type="date" id="to" value="2025-11-14" />
          </div>
        </div>
        <div class="control">
          <label>Seance</label>
          <select id="session">
            <option value="all" selected>V≈°e</option>
            <option value="BMO">BMO (Before Market Open)</option>
            <option value="AMC">AMC (After Market Close)</option>
          </select>
        </div>
        <div class="control">
          <label>eToro filtr</label>
          <select id="etoro">
            <option value="off" selected>Vypnuto</option>
            <option value="on">Zobrazit jen tituly z eTora</option>
          </select>
        </div>
        <div class="control">
          <label>Min. cena (USD)</label>
          <input type="number" id="minPrice" value="0" />
        </div>
        <div class="control">
          <label>Min. denn√≠ obrat (USD)</label>
          <select id="minDollarVol">
            <option value="0" selected>bez limitu</option>
            <option value="2000000">‚â• 2m</option>
            <option value="5000000">‚â• 5m</option>
            <option value="10000000">‚â• 10m</option>
          </select>
        </div>
        <div class="control">
          <label>Nahr√°t data (CSV/JSON)</label>
          <input type="file" id="file" accept=".csv,.json" />
        </div>
      </div>

      <div class="toolbar">
        <div style="display:flex; gap:8px; align-items:center">
          <button class="btn" id="loadDemo">Naƒç√≠st demo</button>
          <button class="btn" id="reset">Reset filtr≈Ø</button>
          <span class="muted">V√Ωsledek: <b id="count">0</b> titul≈Ø</span>
        </div>
        <div class="switch">
          <span class="chip">Form√°t JSON: [{"ticker":"AAPL","date":"2025-11-04","session":"AMC","name":"Apple"}]</span>
        </div>
      </div>

      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Spoleƒçnost</th>
              <th>Datum</th>
              <th>Seance</th>
              <th class="mono">Cena*</th>
              <th class="mono">Obrat*</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="muted" style="margin-top:8px">* Cena a denn√≠ obrat jsou voliteln√© sloupce (pokud je dod√°≈° v datasetu), lze podle nich filtrovat.</p>
    </section>

    <p class="footer">Tip: pro eToro filtr se na pozad√≠ st√°hne ve≈ôejn√Ω seznam obchodovateln√Ωch instrument≈Ø z etoro.com (bez p≈ôihl√°≈°en√≠). Data z Market Chameleon nahr√°vej pouze p≈ôes jejich povolen√Ω CSV/JSON export.</p>
  </div>

  <script>
    // ====== Stav a promƒõnn√© ======
    const el = (s) => document.querySelector(s);
    const tbody = el('#tbl tbody');
    const state = { rows: [], etoroSet: null, theme: localStorage.getItem('theme') || 'dark' };

    // ====== Utility ======
    function fmtDate(s){ return s ? new Date(s+'T00:00:00').toLocaleDateString('cs-CZ') : '‚Äî'; }
    function pillSession(v){ if(!v) return '‚Äî'; const t=v.toUpperCase(); return `<span class="pill ${t==='AMC'?'amc':'bmo'}">${t}</span>` }

    function withinRange(d, from, to){ if(!d) return false; const x = d.split('T')[0]; return (!from || x>=from) && (!to || x<=to); }

    function parseCSV(text){
      // velmi jednoduch√Ω CSV parser (ƒç√°rka, bez uvozovek v hodnot√°ch)
      const [head, ...lines] = text.trim().split(/\r?\n/);
      const cols = head.split(',').map(s=>s.trim());
      return lines.map(line => {
        const vals = line.split(',').map(s=>s.trim());
        const o={}; cols.forEach((c,i)=>o[c]=vals[i]);
        // normalizace n√°zv≈Ø
        o.ticker = o.ticker || o.Ticker || o.Symbol || o.symbol;
        o.date = o.date || o.Date || o.EarningsDate || o.earnings_date;
        o.session = (o.session || o.Session || o.Time || '').toUpperCase().replace('BEFORE MARKET OPEN','BMO').replace('AFTER MARKET CLOSE','AMC');
        o.name = o.name || o.Company || o.company || '';
        if(o.price) o.price = Number(o.price);
        if(o.dollar_volume) o.dollar_volume = Number(o.dollar_volume);
        return o;
      });
    }

    function applyFilters(){
      const from = el('#from').value; const to = el('#to').value;
      const sess = el('#session').value; const etoro = el('#etoro').value;
      const minPrice = Number(el('#minPrice').value||0);
      const minDol = Number(el('#minDollarVol').value||0);
      let rows = state.rows.filter(r => withinRange(r.date, from, to));
      if(sess!== 'all') rows = rows.filter(r => (r.session||'').toUpperCase()===sess);
      if(minPrice>0) rows = rows.filter(r => (r.price||0) >= minPrice);
      if(minDol>0) rows = rows.filter(r => (r.dollar_volume||0) >= minDol);
      if(etoro==='on'){ if(state.etoroSet){ rows = rows.filter(r => state.etoroSet.has((r.ticker||'').toUpperCase())); } }
      return rows.sort((a,b)=> (a.date<b.date?-1:a.date>b.date?1: (a.ticker>b.ticker?1:-1)) );
    }

    function render(){
      document.documentElement.setAttribute('data-theme', state.theme);
      const rows = applyFilters();
      el('#count').textContent = rows.length;
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td class="mono"><b>${(r.ticker||'').toUpperCase()}</b></td>
          <td>${r.name||'‚Äî'}</td>
          <td class="mono">${fmtDate(r.date)}</td>
          <td>${pillSession(r.session)}</td>
          <td class="mono">${r.price!=null? r.price.toFixed(2): '‚Äî'}</td>
          <td class="mono">${r.dollar_volume!=null? Intl.NumberFormat('en-US',{notation:'compact'}).format(r.dollar_volume): '‚Äî'}</td>
        </tr>
      `).join('');
      el('#updated').textContent = 'Aktualizov√°no: ' + new Date().toLocaleString('cs-CZ');
    }

    // ====== eToro seznam (ve≈ôejn√Ω feed) ======
    async function loadEtoro(){
      try{
        const url = 'https://www.etoro.com/sapi/instrumentsmetadata/V1/instruments?includeStocks=true&includeIndices=false&includeEtfs=true';
        const j = await fetch(url, { mode: 'cors' }).then(r=>r.json());
        const set = new Set();
        const arr = (j.Instruments || j || []);
        for(const it of arr){
          if(it && it.IsTradable && (it.InstrumentTypeID===1 || it.InstrumentTypeID===5)){ // 1=stock, 5=ETF
            const sym = (it.SymbolFull||'').toUpperCase();
            if(sym) set.add(sym);
          }
        }
        state.etoroSet = set; render();
      }catch(e){ console.warn('eToro feed nelze naƒç√≠st (CORS na GitHub Pages m≈Ø≈æe blokovat). Pou≈æij lok√°ln√≠ whitelist).'); }
    }

    // ====== Naƒçten√≠ dat (demo / soubor) ======
    const DEMO = [
      {ticker:'UBER', name:'Uber Technologies', date:'2025-11-04', session:'AMC', price: 74.20, dollar_volume: 120000000},
      {ticker:'PYPL', name:'PayPal Holdings', date:'2025-11-05', session:'AMC', price: 58.30, dollar_volume: 98000000},
      {ticker:'QCOM', name:'Qualcomm', date:'2025-11-05', session:'AMC', price: 132.40, dollar_volume: 110000000},
      {ticker:'ABNB', name:'Airbnb', date:'2025-11-06', session:'AMC', price: 153.10, dollar_volume: 65000000},
      {ticker:'COIN', name:'Coinbase', date:'2025-11-07', session:'AMC', price: 198.40, dollar_volume: 175000000},
      {ticker:'DIS',  name:'Walt Disney', date:'2025-11-12', session:'AMC', price: 104.70, dollar_volume: 82000000}
    ];

    // ====== Autoload konfigurace ======
    const DEFAULT_DATA_URL = './data/earnings_2025-11-03_14.json';
    const urlParams = new URLSearchParams(location.search);
    const SRC_PARAM = urlParams.get('src'); // voliteln√©: ?src=/data/earnings.json

    async function loadAutoData(){
      const src = SRC_PARAM || DEFAULT_DATA_URL;
      try{
        const resp = await fetch(src, { cache: 'no-store' });
        if(!resp.ok) throw new Error('HTTP '+resp.status);
        const rows = await resp.json();
        if(!Array.isArray(rows)) throw new Error('Neplatn√Ω form√°t JSON');
        state.rows = normalizeRows(rows);
        el('#updated').textContent = 'Naƒçteno z: ' + (new URL(src, location.href)).pathname;
        render();
      }catch(e){
        console.warn('Autoload selhal, z≈Øst√°v√° pr√°zdn√° tabulka. D≈Øvod:', e.message);
        // nech√°me k dispozici tlaƒç√≠tko "Naƒç√≠st demo" a nahr√°v√°n√≠ souboru
      }
    }

    function normalizeRows(rows){
      return rows.map(r=>({
        ticker: (r.ticker||r.Ticker||r.Symbol||'').toUpperCase(),
        name: r.name||r.Company||r.company||'',
        date: (r.date||r.Date||r.earnings_date||r.EarningsDate||'').slice(0,10),
        session: (r.session||r.Session||r.Time||'').toUpperCase().replace('BEFORE MARKET OPEN','BMO').replace('AFTER MARKET CLOSE','AMC'),
        price: r.price!=null? Number(r.price): (r.Price? Number(r.Price): null),
        dollar_volume: r.dollar_volume!=null? Number(r.dollar_volume): (r.DollarVolume? Number(r.DollarVolume): null)
      })).filter(x=> x.ticker && x.date);
    }

    el('#loadDemo').addEventListener('click', ()=>{ state.rows = normalizeRows(DEMO); render(); });

    el('#file').addEventListener('change', async (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const text = await f.text();
      let rows=[];
      try{
        if(f.name.endsWith('.json')) rows = JSON.parse(text);
        else rows = parseCSV(text);
      }catch(err){ alert('Soubor se nepoda≈ôilo naƒç√≠st: '+err.message); return; }
      state.rows = normalizeRows(rows);
      render();
    });

    // ====== Bindings ======
    ['from','to','session','etoro','minPrice','minDollarVol'].forEach(id=>{
      el('#'+id).addEventListener('input', render);
      el('#'+id).addEventListener('change', render);
    });
    el('#reset').addEventListener('click', ()=>{
      el('#from').value='2025-11-03'; el('#to').value='2025-11-14'; el('#session').value='all'; el('#etoro').value='off'; el('#minPrice').value='0'; el('#minDollarVol').value='0'; render();
    });

    const themeBtn = el('#themeBtn');
    themeBtn.addEventListener('click', ()=>{ state.theme = state.theme==='dark'?'light':'dark'; localStorage.setItem('theme', state.theme); render(); });

    // Init
    (async function(){
      await loadEtoro();
      await loadAutoData(); // pokus√≠ se naƒç√≠st /data/earnings_2025-11-03_14.json (nebo ?src=...)
      render();
    })();
  </script>
</body>
</html>
